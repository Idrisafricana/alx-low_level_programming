More fuctions, Nested loops that I barely understand
